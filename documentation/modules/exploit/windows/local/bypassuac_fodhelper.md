## Overview
This module will bypass Windows UAC in Windows 10 by hijacking a special key in the Registry under the current user hive, and inserting a custom command that will get invoked when the Windows FodHelper is launched. It will spawn a second shell that has the UAC flag turned off. This module modifies a registry key, but cleans up the key once the payload has been invoked.

The module requires the architecture of the payload to match the OS.  An x64 OS will require and x64 payload.

This module requires that the user attached to the session selected is an administrator and that UAC is not set to 'Always Notify'.

If specifying EXE::Custom your DLL should call ExitProcess() after starting your payload in a separate process.

## Method
This method was discoverd by Christian B. "winscripting" and uses the fodhelper.exe included with Windows 10 to manage region-specific keyboard settings.

fodhelper.exe looks for the registry keys in `HKCU:\Software\Classes\ms-settings\shell\open\command` which does not exist by default in Windows 10. By adding values to this registry location a payload can be executed with high integrety thus bypassing UAC.

See blog post for specifics: https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/

## Vulnerable Application

* Windows 10

## Verification Steps

  1. Gain a shell on a Windows 10 machine where session's user is an Administrator
  2. `use exploit/windows/local/bypassuac_fodhelper`
  3. Set a payload matching the machine's architecture.
  4. Set LHOST and LPORT as appropreate.
  5. Set the module 'Session' option to the correct session.
  6. `run`
  7. Enjoy a shell without UAC
  8. (Optional) Run post/windows/manage/priv_migrate to automatically migrate into a System level process.


## Known Issues
The only known issue is that a blue screen may quickly flash on the target machine when fodhelper is called.






