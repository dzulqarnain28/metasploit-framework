# -*- coding:binary -*-
require 'spec_helper'
require 'rasn1'


RSpec.describe Msf::Exploit::Remote::Kerberos::Client::Pkinit do
  subject do
    mod = ::Msf::Exploit.new
    mod.extend ::Msf::Exploit::Remote::Kerberos::Client
    mod.send(:initialize)
    mod
  end

  let(:pfx) do
    cert = OpenSSL::PKCS12.new(Base64.decode64('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'), '')
    cert
  end

  describe "#build_pa_data" do
    context "when ..." do
      it "works" do
        result = subject.build_pa_pk_as_req(pfx, 'abc', {})
        print(result.encode.unpack('H*'))
      end
    end
  end
end

