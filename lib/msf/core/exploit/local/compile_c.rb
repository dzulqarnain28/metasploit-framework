# -*- coding: binary -*-

module Msf
module Exploit::Local::CompileC

  attr_accessor :cpu
  attr_accessor :cparser

  def setup
    super
    guess_arch = (target_arch ? target_arch.first : ARCH_X86)
    case guess_arch
    when ARCH_X86
      metasm_arch = Metasm::Ia32
    when ARCH_X86_64
      metasm_arch = Metasm::X86_64
    when ARCH_X64
      metasm_arch = Metasm::X86_64
    else
      metasm_arch = Metasm::Ia32
    end
    init_metasm(metasm_arch.new)
  end

  def init_metasm(cpu, cparser=nil)
    @cpu = cpu
    @cparser = cparser || @cpu.new_cparser
  end

end
end
