# -*- coding: binary -*-

#
# This class acts as standalone authenticator for Kerberos
#
class Msf::Exploit::Remote::Kerberos::ServiceAuthenticator::SMB < Msf::Exploit::Remote::Kerberos::ServiceAuthenticator::Base
  def initialize(**options)
    default_options = {
      send_delegated_creds: Delegation::NEVER
    }
    super(**default_options.merge(options))
  end

  # @param [Hash] options
  # @return [Hash] The security_blob SPNEGO GSS and TGS session key
  def authenticate(options = {})
    sname = options.fetch(:sname) do
      Rex::Proto::Kerberos::Model::PrincipalName.new(
        name_type: Rex::Proto::Kerberos::Model::NameType::NT_SRV_INST,
        name_string: [
          "cifs",
          options.fetch(:hostname) { hostname }
        ]
      )
    end

    super(options.merge({ sname: sname }))
  end
end
